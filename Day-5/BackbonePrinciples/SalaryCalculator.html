<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Salary Calculator</title>
	
	<script src="jquery-1.11.0.js"></script>
	<style>
	label {
		display : block;
	}
	</style>
	<script type="text/javascript">
	function SalaryCalculator(){
		var _salary = 0,
			_basic = 0,
			_hra = 0,
			_da = 0,
			_tax = 0;
		this.basic = function(val){
			if (typeof val === "undefined") return _basic;
			_basic = val;
			this.triggerChange("basic");
		};
		this.hra = function(val){
			if (typeof val === "undefined") return _hra;
			_hra = val;
			this.triggerChange("hra");
		};
		this.da = function(val){
			if (typeof val === "undefined") return _da;
			_da = val;
			this.triggerChange("da");
		};
		this.tax = function(val){
			if (typeof val === "undefined") return _tax;
			_tax = val;
			this.triggerChange("tax");
		};
		this.salary = function(val){
			if (typeof val === "undefined") return _salary;
			_salary = val;
			this.triggerChange("salary");
		};
		//this.onSalaryChange = function(){};
	}
	SalaryCalculator.prototype.Calculate = function(){
		var gross = this.basic() + this.hra() + this.da();
		var net = ((100 - this.tax())/100) * gross;
		this.salary(net);
		//this.onSalaryChange();

	}
	SalaryCalculator.prototype.onChange = function(attrName,callbackFn){
		if (!this._events) this._events = {};
		if (typeof this._events[attrName] === "undefined") this._events[attrName] = [];
		this._events[attrName].push(callbackFn);
	}
	SalaryCalculator.prototype.triggerChange = function(attrName){
		for(var i=0;!!this._events[attrName] && i < this._events[attrName].length;i++){
			var callback = this._events[attrName][i];
			callback();
		}
	}


	var calc = new SalaryCalculator();
	$(function(){
		
		/*calc.onSalaryChange = function(){
			$("#divSalary").text(calc.salary);
		}*/
		// Reacting to model changes
		calc.onChange("salary",function(){
			$("#divSalary").text(calc.salary());
		});
		calc.onChange("basic",function(){
			$("#txtBasic").val(calc.basic());
		});
		calc.onChange("hra",function(){
			$("#txtHra").val(calc.hra());
		});
		calc.onChange("da",function(){
			$("#txtDa").val(calc.da());
		});
		calc.onChange("tax",function(){
			$("#rangeTax").val(calc.tax());
			$("#spanTax").text(calc.tax());
		});
		

		//Reacting to View Changes
		$("#txtBasic").change(function(){
			calc.basic(parseInt(this.value));
		});

		$("#txtHra").change(function(){
			calc.hra(parseInt(this.value));
		});
	
		$("#txtDa").change(function(){
			calc.da(parseInt(this.value));
		});
	
		$("#rangeTax").change(function(){
			calc.tax(parseInt(this.value));
			
		});
	
		$("#btnCalculate").click(function(){
			calc.Calculate();
		});

		
	});

	</script>
</head>
<body>
	<input type="button" value="Dummy" id="btnDummy">
	<h1>Salary Calculator</h1>
	<hr>
	<div>
		<label for="txtBasic">Basic :</label>
		<input type="text" name="" id="txtBasic" >
	</div>
	<div><label for="txtHra">Hra :</label><input type="text" name="" id="txtHra" ></div>
	<div><label for="txtDa">DA :</label><input type="text" id="txtDa" ></div>
	<div>
		<label for="rangeTax">Tax :</label>
		<input type="range" name="" id="rangeTax" min="0" max="50" value="0">
		<span id="spanTax">[Tax%]</span>
	</div>
	<div><input type="button" value="Calculate" id="btnCalculate"></div>
	<div>
		<div id="divSalary"></div>
	</div>
	<div>
		<ul id="ulErrorList">
		</ul>
	</div>
</body>
</html>